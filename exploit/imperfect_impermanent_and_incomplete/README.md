# Exploit 400 - Imperfect Impermanent and Incomplete
## Description
All things in this universe are imperfect, impermanent, and incomplete. It's what makes many jobs necessary, including cybersecurity. Anything ever created has flaws and all things degrade, erode, and become obsolete. Our job is to patch the holes. Find the bugs. Stand watch. Clean up the mess. Tend the fire. It's a job that is endless and often thankless. I've known a lot of colleagues that got overwhelmed by it. The constant vigilance and need to absorb yourself in cybersecurity news and learning on a daily basis causes stress until they burn out.

Well, I've developed a little helper. I call itt Secret-Keeper! A program that those people can interact with for therapeutic purposes. The perfect secret-keeper that will take those stressful thoughts and store them away forever. Give it a try, but please keep in mind that it is also imperfect, impermanent, and incomplete. You might need to stumble through a learning curve.

Your target is 35.184.182.18 on port 32005

```
ldd (Ubuntu GLIBC 2.39-0ubuntu8.3) 2.39
gcc -o /usr/bin/Exploit400 /Exploit400.c
```

## Solution
The main vulnerability is the one-off indexing issue which allows for a one-byte overwrite into the next block. This can be used to overwrite the metadata of the next block such that the next time this block is allocated, it will overlap with the filename to read.

The exploit starts with mallocing two blocks of size 24 and then mallocing the filename. The heap layout is then [a -> b -> filename]. We then free a before claiming a again and then overwriting it with 25 'A's. This has allowed it to overwrite the metadata of block b which now thinks it its size 0x40 (A is 0x41 but the 0x01 is used as some flag). Now we free b and then it will be put into the tcache of size 0x40. Mallocing b again, but this time with size 56 = 0x40 - 8 gives b which overlaps into the next chunk, which is the filename. We can then overwrite the filename to be read to the flag filename and then read the flag.

## Flag
`poctf{uwsp_7h3_unb34r4bl3_l1gh7n355}`
